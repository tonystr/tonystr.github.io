{"version":3,"sources":["pages/Kanji.jsx","../node_modules/class-names/index.js","../node_modules/classnames/index.js"],"names":["canvasDraw","e","setCoords","target","ctx","document","getElementById","getContext","console","log","clientX","undefined","touches","clientY","tagName","rect","getBoundingClientRect","x","y","px","window","mousePrevious","down","py","beginPath","lineWidth","strokeStyle","lineCap","moveTo","lineTo","stroke","Math","abs","prev","newCoords","map","list","slice","length","push","floor","width","height","base36","coord","str","toString","KanjiInspector","kanji","className","type","index","KanjiPage","useState","innerHeight","canvasSize","setCanvasSize","coords","strokes","setStrokes","results","setResults","inspect","setInspect","strokeBased","setStrokeBased","useEffect","updateCanvasSize","addEventListener","removeEventListener","req","reduce","acc","fetch","encodeURIComponent","then","res","bodyUsed","text","out","JSON","parse","Error","error","draw","clearMouseListener","id","onMouseDown","onTouchStart","onClick","title","canvas","clearRect","style","min","innerWidth","classNames","i","kanjis","find","k","module","exports","require","hasOwn","hasOwnProperty","classes","arguments","arg","argType","Array","isArray","inner","apply","Object","prototype","key","call","join","default"],"mappings":"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","file":"static/js/15.08a48f58.chunk.js","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport Header from '../components/Header.jsx';\r\nimport classNames from 'class-names';\r\nimport '../styles/kanji.scss';\r\nimport kanjis from '../data/kanji.js';\r\n\r\nconst CANVAS_SIZE = 36 * 36;\r\n\r\nwindow.mousePrevious = { x: null, y: null, down: false };\r\n\r\nfunction canvasDraw(e, setCoords) {\r\n    const target = e.target;\r\n    const canvas = document.getElementById('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    console.log(e);\r\n\r\n    const clientX = e.clientX !== undefined ? e.clientX : e.touches[0].clientX;\r\n    const clientY = e.clientY !== undefined ? e.clientY : e.touches[0].clientY;\r\n\r\n    if (target === undefined || target.tagName !== 'CANVAS') {\r\n        // document.removeEventListener('mousemove', canvasDraw);\r\n        // window.mousePrevious.down = false;\r\n        return false;\r\n    }\r\n\r\n    const rect = target.getBoundingClientRect();\r\n\r\n    const x = clientX - rect.x;\r\n    const y = clientY - rect.y;\r\n    const px = window.mousePrevious.down ? window.mousePrevious.x : x;\r\n    const py = window.mousePrevious.down ? window.mousePrevious.y : y;\r\n    // const dis = Math.sqrt(Math.pow(x - px, 2) + Math.pow(y - py, 2));\r\n\r\n    ctx.beginPath();\r\n    ctx.lineWidth = 8;\r\n    ctx.strokeStyle = '#ffffff';\r\n    ctx.lineCap = 'round';\r\n    ctx.moveTo(px, py);\r\n    ctx.lineTo(x, y);\r\n    ctx.stroke();\r\n\r\n    if (Math.abs(x - px) > 3 || Math.abs(y - py) > 3) {\r\n        setCoords(prev => {\r\n            const newCoords = prev.map(list => list.slice());\r\n            newCoords[newCoords.length - 1].push({\r\n                x: Math.floor((x / rect.width)  * CANVAS_SIZE),\r\n                y: Math.floor((y / rect.height) * CANVAS_SIZE)\r\n            });\r\n            return newCoords;\r\n        });\r\n    }\r\n\r\n    window.mousePrevious = {\r\n        x: x,\r\n        y: y,\r\n        down: true\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction base36(coord) {\r\n    // if (isNaN(coord) || coord < 0 || coord >= CANVAS_SIZE) {\r\n    //     throw 'bad coordinate ' + coord;\r\n    // }\r\n    let str = coord.toString(36);\r\n    return str.length === 1 ? '0' + str : str;\r\n}\r\n\r\nfunction KanjiInspector({ kanji }) {\r\n    return (\r\n        <div className='inspector'>\r\n            <div className='foc'>\r\n                {['number', 'character', 'radical', 'stroke-count', 'meaning', 'reading'].map(\r\n                    (type, index) => <div className={type} key={type}>{kanji[index]}</div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default function KanjiPage() {\r\n    const [canvasSize, setCanvasSize] = useState({\r\n        width:  window.innerHeight - 374,\r\n        height: window.innerHeight - 374\r\n    });\r\n    const [coords,  setCoords ] = useState([]);\r\n    const [strokes, setStrokes] = useState(0);\r\n    const [results, setResults] = useState([]);\r\n    const [inspect, setInspect] = useState(null);\r\n    const [strokeBased, setStrokeBased] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const updateCanvasSize = () => setCanvasSize({\r\n            width:  window.innerHeight - 374,\r\n            height: window.innerHeight - 374\r\n        });\r\n\r\n        window.addEventListener('resize', updateCanvasSize);\r\n\r\n        return () => window.removeEventListener('resize', updateCanvasSize);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (strokes <= 0) return;\r\n\r\n        let req = coords.reduce(\r\n            (req, list) => list.length ?\r\n                req + list.reduce((acc, coord) => acc + base36(coord.x) + base36(coord.y), '') + '\\n' :\r\n                req,\r\n            strokeBased ? 'HL ' : 'hL '\r\n        );\r\n\r\n        // Another scary API request, but omg the results are amazing\r\n        fetch(`https://urlreq.appspot.com/req?method=POST&url=https://kanji.sljfaq.org/hw-17.cgi&body=${encodeURIComponent(req)}`).then(\r\n            res => !res.bodyUsed && res.text().then(res => {\r\n                console.log(res);\r\n                try {\r\n                    let out = JSON.parse(res);\r\n                    if (!out.results || !out.results.length) throw new Error('No results');\r\n                    setResults(out.results);\r\n                } catch (e) {\r\n                    console.error(e);\r\n                }\r\n            })\r\n        );\r\n    }, [strokes, strokeBased]);\r\n\r\n    const clearCanvas = () => {\r\n        const canvas = document.getElementById('canvas');\r\n        const ctx = canvas.getContext('2d');\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        setCoords([]);\r\n        setStrokes(0);\r\n    }\r\n\r\n    const draw = e => canvasDraw(e, setCoords);\r\n\r\n    const clearMouseListener = () => {\r\n        window.mousePrevious.down = false;\r\n        setStrokes(prev => prev + 1);\r\n        document.removeEventListener('mousemove', draw);\r\n        document.removeEventListener('mouseup', clearMouseListener);\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Header />\r\n            <div className='kanji-page'>\r\n                <div\r\n                    className='canvas-container'\r\n                    width={canvasSize.width}\r\n                    height={canvasSize.height}\r\n                >\r\n                    <canvas\r\n                        id='canvas'\r\n                        className='kanji-canvas'\r\n                        width={canvasSize.width - 11}\r\n                        height={canvasSize.height - 11}\r\n                        onMouseDown={e => {\r\n                            setCoords(prev => [...prev.map(list => list.slice()), []]);\r\n                            canvasDraw(e, setCoords);\r\n                            document.addEventListener('mousemove', draw);\r\n                            document.addEventListener('mouseup', clearMouseListener);\r\n                        }}\r\n                        onTouchStart={e => {\r\n                            setCoords(prev => [...prev.map(list => list.slice()), []]);\r\n                            canvasDraw(e, setCoords);\r\n                            document.addEventListener('touchmove', draw);\r\n                            document.addEventListener('touchend', clearMouseListener);\r\n                        }}\r\n                        onClick={e => {\r\n                            canvasDraw(e, setCoords);\r\n                            window.mousePrevious.down = false;\r\n                        }}\r\n                    />\r\n                    <div className='controls'>\r\n                        <i\r\n                            title='Clear'\r\n                            className='fas fa-redo'\r\n                            onClick={clearCanvas}\r\n                        />\r\n                        <i\r\n                            title={strokeBased ? 'Match by image' : 'Match by stroke'}\r\n                            className={`fas fa-${strokeBased ? 'random' : 'paint-brush'}`}\r\n                            onClick={() => setStrokeBased(prev => !prev)}\r\n                        />\r\n                    </div>\r\n                </div>\r\n                <div className='results' style={{\r\n                    width:  Math.min(window.innerWidth - canvasSize.width, 500),\r\n                    height: canvasSize.height\r\n                }}>\r\n                <div className={classNames('search-results', { 'small': !!inspect })}>\r\n                        {results.map((kanji, i) => (\r\n                            <span\r\n                                key={i}\r\n                                onClick={() => setInspect(kanjis.find(k => k[1] === kanji))}\r\n                            >\r\n                                {kanji}\r\n                            </span>\r\n                        ))}\r\n                    </div>\r\n                    {inspect && <KanjiInspector kanji={inspect} />}\r\n                </div>\r\n            </div>\r\n        </>\r\n    );\r\n    // <textarea id='copybox' />\r\n}\r\n","module.exports = require('classnames');\n","/*!\n  Copyright (c) 2018 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames() {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg)) {\n\t\t\t\tif (arg.length) {\n\t\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\t\tif (inner) {\n\t\t\t\t\t\tclasses.push(inner);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tif (arg.toString === Object.prototype.toString) {\n\t\t\t\t\tfor (var key in arg) {\n\t\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tclasses.push(arg.toString());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n"],"sourceRoot":""}