{"version":3,"sources":["pages/Kanji.jsx","../node_modules/class-names/index.js","../node_modules/classnames/index.js"],"names":["CANVAS_SIZE","canvasDraw","e","setCoords","target","ctx","document","getElementById","getContext","console","log","clientX","undefined","touches","clientY","tagName","rect","getBoundingClientRect","x","y","px","window","mousePrevious","down","py","beginPath","lineWidth","strokeStyle","lineCap","moveTo","lineTo","stroke","Math","abs","prev","newCoords","map","list","slice","length","push","floor","width","height","base36","coord","str","toString","KanjiInspector","_ref","kanji","react__WEBPACK_IMPORTED_MODULE_2___default","a","createElement","className","type","index","key","KanjiPage","_useState","useState","innerHeight","_useState2","Object","C_Users_Tony_Documents_Webdev_tonystr_website_master_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_slicedToArray__WEBPACK_IMPORTED_MODULE_1__","canvasSize","setCanvasSize","_useState3","_useState4","coords","_useState5","_useState6","strokes","setStrokes","_useState7","_useState8","results","setResults","_useState9","_useState10","inspect","setInspect","_useState11","_useState12","strokeBased","setStrokeBased","useEffect","updateCanvasSize","addEventListener","removeEventListener","req","reduce","acc","fetch","concat","encodeURIComponent","then","res","bodyUsed","text","out","JSON","parse","error","draw","clearMouseListener","Fragment","_components_Header_jsx__WEBPACK_IMPORTED_MODULE_3__","id","onMouseDown","C_Users_Tony_Documents_Webdev_tonystr_website_master_node_modules_babel_preset_react_app_node_modules_babel_runtime_helpers_esm_toConsumableArray__WEBPACK_IMPORTED_MODULE_0__","onTouchStart","onClick","title","canvas","clearRect","style","min","innerWidth","classNames","small","i","kanjis","find","k","module","exports","__webpack_require__","__WEBPACK_AMD_DEFINE_RESULT__","hasOwn","hasOwnProperty","classes","arguments","arg","argType","Array","isArray","inner","apply","call","join","default"],"mappings":"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","file":"static/js/15.fd9fd859.chunk.js","sourcesContent":["import React, { useState, useEffect } from 'react';\r\nimport Header from '../components/Header.jsx';\r\nimport classNames from 'class-names';\r\nimport '../styles/kanji.scss';\r\nimport kanjis from '../data/kanji.js';\r\n\r\nconst CANVAS_SIZE = 36 * 36;\r\n\r\nwindow.mousePrevious = { x: null, y: null, down: false };\r\n\r\nfunction canvasDraw(e, setCoords) {\r\n    const target = e.target;\r\n    const canvas = document.getElementById('canvas');\r\n    const ctx = canvas.getContext('2d');\r\n\r\n    console.log(e);\r\n\r\n    const clientX = e.clientX !== undefined ? e.clientX : e.touches[0].clientX;\r\n    const clientY = e.clientY !== undefined ? e.clientY : e.touches[0].clientY;\r\n\r\n    if (target === undefined || target.tagName !== 'CANVAS') {\r\n        // document.removeEventListener('mousemove', canvasDraw);\r\n        // window.mousePrevious.down = false;\r\n        return false;\r\n    }\r\n\r\n    const rect = target.getBoundingClientRect();\r\n\r\n    const x = clientX - rect.x;\r\n    const y = clientY - rect.y;\r\n    const px = window.mousePrevious.down ? window.mousePrevious.x : x;\r\n    const py = window.mousePrevious.down ? window.mousePrevious.y : y;\r\n    // const dis = Math.sqrt(Math.pow(x - px, 2) + Math.pow(y - py, 2));\r\n\r\n    ctx.beginPath();\r\n    ctx.lineWidth = 8;\r\n    ctx.strokeStyle = '#ffffff';\r\n    ctx.lineCap = 'round';\r\n    ctx.moveTo(px, py);\r\n    ctx.lineTo(x, y);\r\n    ctx.stroke();\r\n\r\n    if (Math.abs(x - px) > 3 || Math.abs(y - py) > 3) {\r\n        setCoords(prev => {\r\n            const newCoords = prev.map(list => list.slice());\r\n            newCoords[newCoords.length - 1].push({\r\n                x: Math.floor((x / rect.width)  * CANVAS_SIZE),\r\n                y: Math.floor((y / rect.height) * CANVAS_SIZE)\r\n            });\r\n            return newCoords;\r\n        });\r\n    }\r\n\r\n    window.mousePrevious = {\r\n        x: x,\r\n        y: y,\r\n        down: true\r\n    }\r\n\r\n    return true;\r\n}\r\n\r\nfunction base36(coord) {\r\n    // if (isNaN(coord) || coord < 0 || coord >= CANVAS_SIZE) {\r\n    //     throw 'bad coordinate ' + coord;\r\n    // }\r\n    let str = coord.toString(36);\r\n    return str.length === 1 ? '0' + str : str;\r\n}\r\n\r\nfunction KanjiInspector({ kanji }) {\r\n    return (\r\n        <div className='inspector'>\r\n            <div className='foc'>\r\n                {['number', 'character', 'radical', 'stroke-count', 'meaning', 'reading'].map(\r\n                    (type, index) => <div className={type} key={type}>{kanji[index]}</div>\r\n                )}\r\n            </div>\r\n        </div>\r\n    );\r\n}\r\n\r\nexport default function KanjiPage() {\r\n    const [canvasSize, setCanvasSize] = useState({\r\n        width:  window.innerHeight - 374,\r\n        height: window.innerHeight - 374\r\n    });\r\n    const [coords,  setCoords ] = useState([]);\r\n    const [strokes, setStrokes] = useState(0);\r\n    const [results, setResults] = useState([]);\r\n    const [inspect, setInspect] = useState(null);\r\n    const [strokeBased, setStrokeBased] = useState(false);\r\n\r\n    useEffect(() => {\r\n        const updateCanvasSize = () => setCanvasSize({\r\n            width:  window.innerHeight - 374,\r\n            height: window.innerHeight - 374\r\n        });\r\n\r\n        window.addEventListener('resize', updateCanvasSize);\r\n\r\n        return () => window.removeEventListener('resize', updateCanvasSize);\r\n    }, []);\r\n\r\n    useEffect(() => {\r\n        if (strokes <= 0) return;\r\n\r\n        let req = coords.reduce(\r\n            (req, list) => list.length ?\r\n                req + list.reduce((acc, coord) => acc + base36(coord.x) + base36(coord.y), '') + '\\n' :\r\n                req,\r\n            strokeBased ? 'HL ' : 'hL '\r\n        );\r\n\r\n        // Another scary API request, but omg the results are amazing\r\n        fetch(`https://urlreq.appspot.com/req?method=POST&url=https://kanji.sljfaq.org/hw-17.cgi&body=${encodeURIComponent(req)}`).then(\r\n            res => !res.bodyUsed && res.text().then(res => {\r\n                console.log(res);\r\n                try {\r\n                    let out = JSON.parse(res);\r\n                    if (!out.results || !out.results.length) throw 'No results';\r\n                    setResults(out.results);\r\n                } catch (e) {\r\n                    console.error(e);\r\n                }\r\n            })\r\n        );\r\n    }, [strokes, strokeBased]);\r\n\r\n    const clearCanvas = () => {\r\n        const canvas = document.getElementById('canvas');\r\n        const ctx = canvas.getContext('2d');\r\n        ctx.clearRect(0, 0, canvas.width, canvas.height);\r\n        setCoords([]);\r\n        setStrokes(0);\r\n    }\r\n\r\n    const draw = e => canvasDraw(e, setCoords);\r\n\r\n    const clearMouseListener = () => {\r\n        window.mousePrevious.down = false;\r\n        setStrokes(prev => prev + 1);\r\n        document.removeEventListener('mousemove', draw);\r\n        document.removeEventListener('mouseup', clearMouseListener);\r\n    }\r\n\r\n    return (\r\n        <>\r\n            <Header />\r\n            <div className='kanji-page'>\r\n                <div\r\n                    className='canvas-container'\r\n                    width={canvasSize.width}\r\n                    height={canvasSize.height}\r\n                >\r\n                    <canvas\r\n                        id='canvas'\r\n                        className='kanji-canvas'\r\n                        width={canvasSize.width - 11}\r\n                        height={canvasSize.height - 11}\r\n                        onMouseDown={e => {\r\n                            setCoords(prev => [...prev.map(list => list.slice()), []]);\r\n                            canvasDraw(e, setCoords);\r\n                            document.addEventListener('mousemove', draw);\r\n                            document.addEventListener('mouseup', clearMouseListener);\r\n                        }}\r\n                        onTouchStart={e => {\r\n                            setCoords(prev => [...prev.map(list => list.slice()), []]);\r\n                            canvasDraw(e, setCoords);\r\n                            document.addEventListener('touchmove', draw);\r\n                            document.addEventListener('touchend', clearMouseListener);\r\n                        }}\r\n                        onClick={e => {\r\n                            canvasDraw(e, setCoords);\r\n                            window.mousePrevious.down = false;\r\n                        }}\r\n                    />\r\n                    <div className='controls'>\r\n                        <i\r\n                            title='Clear'\r\n                            className='fas fa-redo'\r\n                            onClick={clearCanvas}\r\n                        />\r\n                        <i\r\n                            title={strokeBased ? 'Match by image' : 'Match by stroke'}\r\n                            className={`fas fa-${strokeBased ? 'random' : 'paint-brush'}`}\r\n                            onClick={() => setStrokeBased(prev => !prev)}\r\n                        />\r\n                    </div>\r\n                </div>\r\n                <div className='results' style={{\r\n                    width:  Math.min(window.innerWidth - canvasSize.width, 500),\r\n                    height: canvasSize.height\r\n                }}>\r\n                <div className={classNames('search-results', { 'small': !!inspect })}>\r\n                        {results.map((kanji, i) => (\r\n                            <span\r\n                                key={i}\r\n                                onClick={() => setInspect(kanjis.find(k => k[1] === kanji))}\r\n                            >\r\n                                {kanji}\r\n                            </span>\r\n                        ))}\r\n                    </div>\r\n                    {inspect && <KanjiInspector kanji={inspect} />}\r\n                </div>\r\n            </div>\r\n        </>\r\n    );\r\n    // <textarea id='copybox' />\r\n}\r\n","module.exports = require('classnames');","/*!\n  Copyright (c) 2017 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n\n/* global define */\n(function () {\n  'use strict';\n\n  var hasOwn = {}.hasOwnProperty;\n\n  function classNames() {\n    var classes = [];\n\n    for (var i = 0; i < arguments.length; i++) {\n      var arg = arguments[i];\n      if (!arg) continue;\n      var argType = typeof arg;\n\n      if (argType === 'string' || argType === 'number') {\n        classes.push(arg);\n      } else if (Array.isArray(arg) && arg.length) {\n        var inner = classNames.apply(null, arg);\n\n        if (inner) {\n          classes.push(inner);\n        }\n      } else if (argType === 'object') {\n        for (var key in arg) {\n          if (hasOwn.call(arg, key) && arg[key]) {\n            classes.push(key);\n          }\n        }\n      }\n    }\n\n    return classes.join(' ');\n  }\n\n  if (typeof module !== 'undefined' && module.exports) {\n    classNames.default = classNames;\n    module.exports = classNames;\n  } else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n    // register as 'classnames', consistent with npm package name\n    define('classnames', [], function () {\n      return classNames;\n    });\n  } else {\n    window.classNames = classNames;\n  }\n})();"],"sourceRoot":""}